# -*- coding: utf-8 -*-
"""
Created on Sun Oct 10 09:13:18 2021
# tweet search and google nlp analysis
@author: 16418
"""
import tweepy

from google.cloud import language_v1
from datetime import datetime, timedelta

#Twitter API credentials
consumer_key = "consumer_key"
consumer_secret = "consumer_secret"
access_token = "access_token"
access_token_secret = "access_token_secret"

# authorize twitter, initialize tweepy
auth = tweepy.OAuthHandler(consumer_key, consumer_secret)
auth.set_access_token(access_token, access_token_secret)
api = tweepy.API(auth)

# twitter search
total_tweets = 50
search_words = input('please input the word you want to seatch')
today_datetime = datetime.today().now()
searchsince_datetime = today_datetime - timedelta(days = 5)
searchsince_date = searchsince_datetime.strftime('%Y-%m-%d') 
searched_tweets = tweepy.Cursor(api.search, q = search_words, 
                                since = searchsince_date, 
                                result_type = 'recent', 
                                lang = 'es').items(total_tweets)

# authorize google cloud
language_client = language_v1.LanguageServiceClient()
document = language_v1.Document(content=searched_tweets, type_=language_v1.Document.Type.PLAIN_TEXT)
SENTI_RESULT = language_client.analyze_sentiment(request={'document': document}).document_sentiment.score

print("SentimentResult: {}".format(SENTI_RESULT))
